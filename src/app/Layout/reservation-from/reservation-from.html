<app-nav></app-nav>
<div class="emergency-form-container">
  <div class="form-header">
    <h1>Emergency Request Form</h1>
    <p>Please provide details for your emergency assistance request</p>
  </div>

  <form #emergencyForm="ngForm" (ngSubmit)="onSubmit()" class="emergency-form">
    <div class="form-grid">
      <!-- Pickup Location -->
      <div class="map-section">
        <div class="section-header">
          <h3>üìç Pickup Location</h3>
          <p>Search for an address or click on the map to select pickup location</p>
        </div>
        <app-map title="Pickup Location" [selectedLocation]="pickupLocation"
          (locationSelected)="onPickupLocationSelected($event)" (locationCleared)="onPickupLocationCleared()"></app-map>
      </div>

      <!-- Drop-off Location -->
      <div class="map-section">
        <div class="section-header">
          <h3>üéØ Drop-off Location</h3>
          <p>Search for an address or click on the map to select drop-off location</p>
        </div>
        <app-map title="Drop-off Location" [selectedLocation]="dropoffLocation"
          (locationSelected)="onDropoffLocationSelected($event)"
          (locationCleared)="onDropoffLocationCleared()"></app-map>
      </div>

      <!-- Form Fields -->
      <div class="form-fields">
        <div class="field-group">
          <label for="pickupAddress">Pickup Address *</label>
          <textarea id="pickupAddress" name="pickupAddress" [(ngModel)]="formData.pickupAddress" required
            class="form-textarea address-field" readonly rows="2"
            placeholder="Select a location on the pickup map"></textarea>
        </div>

        <div class="field-group">
          <label for="dropOffAddress">Drop-off Address *</label>
          <textarea id="dropOffAddress" name="dropOffAddress" [(ngModel)]="formData.dropOffAddress" required
            class="form-textarea address-field" readonly rows="2"
            placeholder="Select a location on the drop-off map"></textarea>
        </div>
        @if (distance && price) {
        <div class="field-group text-center">
          <span class="text-info fs-5">
            Distance: {{ distance.toFixed(2) }} KM | Price: {{ price.toFixed(2) }} EGP
          </span>
        </div>
        } @else if (isloading) {
        <div class="field-group text-center">
          <span class="text-info fs-5 text-success">Calculating distance and price...</span>
        </div>
        }


        <div class="field-group">
          <label for="scheduledDate">Scheduled Date & Time *</label>
          <input type="datetime-local" id="scheduledDate" name="scheduledDate" [(ngModel)]="formData.scheduledDate"
            required class="form-input" [min]="minDateTime" />
        </div>

        <div class="field-group">
          <label for="emergencyType">Destination Type *</label>
          <select id="emergencyType" name="emergencyType" [(ngModel)]="formData.emergencyType" required
            class="form-input">
            <option value="">Select destination</option>
            <option value="doctor">üë®‚Äç‚öïÔ∏è Doctor</option>
            <option value="hospital">üè• Hospital</option>
            <option value="pharmacy">üíä Pharmacy</option>
            <option value="clinic">üè® Clinic</option>
            <option value="other">‚ùì Other Medical Place</option>
          </select>
        </div>
        <!-- <div class="field-group">
          <label for="emergencyType">Fully Equipped Transport Vehicle *</label>
          <select id="emergencyType" name="emergencyType" [(ngModel)]="formData.emergencyType" required
            class="form-input">
            <option value="">Select option</option>
            <option value="yes">‚úÖ Yes, I need a fully equipped vehicle</option>
            <option value="no">‚ùå No, a regular vehicle is fine</option>
          </select>
        </div> -->

        <div class="field-group">
          <label for="notes">Additional Notes</label>
          <textarea id="notes" name="notes" [(ngModel)]="formData.notes" class="form-textarea"
            placeholder="Provide any additional details about the emergency..." rows="4"></textarea>
        </div>

        <div class="form-actions">
          <button type="submit" class="submit-btn" [disabled]="emergencyForm.invalid || isSubmitting">
            <span class="btn-icon">{{ isSubmitting ? '‚è≥' : 'üö®' }}</span>
            {{ isSubmitting ? 'Submitting...' : 'Submit Emergency Request' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Status Messages -->
    <div class="status-messages">
      @if (successMessage) {
      <div class="success-message">
        <span class="message-icon">‚úÖ</span>
        {{ successMessage }}
      </div>
      }

      @if (errorMessage) {
      <div class="error-message">
        <span class="message-icon">‚ùå</span>
        {{ errorMessage }}
      </div>
      }

      @if (validationErrors.length > 0) {
      @if (validationErrors.length > 0) {
      <div class="validation-errors">
        <div class="error-header">
          <span class="message-icon">‚ö†Ô∏è</span>
          Please fix the following errors:
        </div>
        <ul>
          @for (error of validationErrors; track $index) {

          <li>{{ error }}</li>
          }
        </ul>
      </div>
      }

      }

    </div>
  </form>
</div>

<app-footer></app-footer>