<div class="user-dashboard-container">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-info text-white">
            <h4 class="mb-0">
              <i class="bi bi-person-circle me-2"></i>
              My Dashboard
            </h4>
          </div>
          <div class="card-body">
            <!-- Loading State -->
            <div *ngIf="loading" class="text-center py-4">
              <div class="spinner-border text-info" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2 text-muted">Loading your data...</p>
            </div>

            <!-- Error State -->
            <div *ngIf="error" class="alert alert-danger">
              <i class="bi bi-exclamation-triangle me-2"></i>
              {{ error }}
            </div>

            <!-- Content -->
            <div *ngIf="!loading && !error">
              <!-- Balance Cards -->
              <div class="row mb-4" *ngIf="userBalance">
                <div class="col-md-4 mb-3">
                  <div class="balance-card bg-primary text-white">
                    <div class="card-body text-center">
                      <i class="bi bi-wallet2 mb-2"></i>
                      <h4 class="mb-1">{{ formatCurrency(userBalance.totalEarnings) }}</h4>
                      <p class="mb-0">Total Earnings</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="balance-card bg-warning text-white">
                    <div class="card-body text-center">
                      <i class="bi bi-clock-history mb-2"></i>
                      <h4 class="mb-1">{{ formatCurrency(userBalance.pendingAmount) }}</h4>
                      <p class="mb-0">Pending Amount</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="balance-card bg-success text-white">
                    <div class="card-body text-center">
                      <i class="bi bi-cash-stack mb-2"></i>
                      <h4 class="mb-1">{{ formatCurrency(userBalance.availableAmount) }}</h4>
                      <p class="mb-0">Available for Withdrawal</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="row mb-4">
                <div class="col-12">
                  <button 
                    class="btn btn-success me-2" 
                    (click)="openWithdrawalModal()"
                    [disabled]="!userBalance || userBalance.availableAmount <= 0">
                    <i class="bi bi-cash-coin me-2"></i>
                    Request Withdrawal
                  </button>
                  <button class="btn btn-outline-info" (click)="loadUserData()">
                    <i class="bi bi-arrow-clockwise me-2"></i>
                    Refresh
                  </button>
                </div>
              </div>

              <!-- Profit History -->
              <div class="row">
                <div class="col-12">
                  <h5 class="mb-3">
                    <i class="bi bi-graph-up me-2"></i>
                    Profit History
                  </h5>
                  <div class="table-responsive">
                    <table class="table table-striped table-hover">
                      <thead class="table-dark">
                        <tr>
                          <th>Trip ID</th>
                          <th>Amount</th>
                          <th>Status</th>
                          <th>Distribution Date</th>
                          <th>Notes</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let profit of profitHistory">
                          <td>{{ profit.tripId }}</td>
                          <td class="fw-bold text-success">{{ formatCurrency(profit.amount) }}</td>
                          <td>
                            <span [class]="getStatusClass(profit.status)">
                              {{ profit.status }}
                            </span>
                          </td>
                          <td>{{ formatDate(profit.distributionDate) }}</td>
                          <td>
                            <span *ngIf="profit.notes" class="text-muted">{{ profit.notes }}</span>
                            <span *ngIf="!profit.notes" class="text-muted">-</span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <!-- Empty State -->
                  <div *ngIf="profitHistory.length === 0" class="text-center py-4">
                    <i class="bi bi-graph-up display-1 text-muted"></i>
                    <h5 class="text-muted mt-3">No profit history found</h5>
                    <p class="text-muted">Your profit history will appear here once you complete trips.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Withdrawal Modal -->
  <div class="modal fade" [class.show]="showWithdrawalModal" [style.display]="showWithdrawalModal ? 'block' : 'none'" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">
            <i class="bi bi-cash-coin me-2"></i>
            Request Withdrawal
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeWithdrawalModal()"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="amount" class="form-label">Amount *</label>
              <input 
                type="number" 
                class="form-control" 
                id="amount" 
                [(ngModel)]="withdrawalRequest.amount" 
                name="amount"
                min="0.01" 
                [max]="userBalance?.availableAmount || 0"
                step="0.01"
                required>
              <div class="form-text">
                Available: {{ formatCurrency(userBalance?.availableAmount || 0) }}
              </div>
            </div>
            
            <div class="mb-3">
              <label for="bankName" class="form-label">Bank Name</label>
              <input 
                type="text" 
                class="form-control" 
                id="bankName" 
                [(ngModel)]="withdrawalRequest.bankName" 
                name="bankName"
                placeholder="Enter bank name">
            </div>

            <div class="mb-3">
              <label for="bankAccount" class="form-label">Bank Account</label>
              <input 
                type="text" 
                class="form-control" 
                id="bankAccount" 
                [(ngModel)]="withdrawalRequest.bankAccount" 
                name="bankAccount"
                placeholder="Enter account number">
            </div>

            <div class="mb-3">
              <label for="notes" class="form-label">Notes (Optional)</label>
              <textarea 
                class="form-control" 
                id="notes" 
                rows="3" 
                [(ngModel)]="withdrawalRequest.notes" 
                name="notes"
                placeholder="Any additional notes..."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeWithdrawalModal()">Cancel</button>
          <button type="button" class="btn btn-success" (click)="createWithdrawalRequest()">
            <i class="bi bi-cash-coin me-2"></i>
            Submit Request
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div *ngIf="showWithdrawalModal" class="modal-backdrop fade show"></div>
</div>
