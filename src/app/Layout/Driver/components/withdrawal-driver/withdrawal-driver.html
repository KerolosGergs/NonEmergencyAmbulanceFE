<div class="card shadow-sm animate__animated animate__fadeIn">
  <div class="card-header d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-2">
      <i class="bi bi-cash-coin"></i>
      <strong>Withdrawal Requests</strong>
    </div>

    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-sm btn-outline-primary" (click)="loadRequests()">
        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
      </button>
    </div>
  </div>

  <div class="card-body">
    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" role="tablist">
      @for (t of tabs; track t.key) {
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            [class.active]="activeTab === t.key"
            type="button"
            (click)="activeTab = t.key"
            role="tab">
            {{ t.label }}
            <span class="badge bg-secondary ms-2">{{ count(t.key) }}</span>
          </button>
        </li>
      }
    </ul>

    @if (loading) {
      <div class="alert alert-info d-flex align-items-center gap-2">
        <i class="bi bi-arrow-repeat"></i> Loading...
      </div>
    }

    @if (error) {
      <div class="alert alert-danger d-flex align-items-center gap-2">
        <i class="bi bi-exclamation-triangle"></i> {{ error }}
      </div>
    }

    @if (!loading && !error && getFiltered().length === 0) {
      <div class="text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted d-block mb-2"></i>
        <div class="text-muted">No {{ getActiveTabLabel() || 'matching' }} requests</div>
      </div>
    } @else {
      <div class="table-responsive">
        <table class="table align-middle table-hover"> <!-- UPDATED: hover -->
          <thead class="table-light">
            <tr>
              <!-- <th>#</th> -->
              <!-- <th>User</th> -->
              <th>Amount</th>
              <th>Requested</th>
              <th>Status</th>
              <th>Processed</th>
              <!-- <th>Admin</th> -->
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            @for (r of getFiltered(); track $index) { <!-- UPDATED: trackById -->
              <tr class="animate__animated animate__fadeInUp">
                <!-- <td class="fw-semibold">#{{ r.id }}</td>
                <td>
                  <div class="d-flex flex-column">
                    <span class="fw-medium">{{ r.userName }}</span>
                    <small class="text-muted">{{ r.userType }}</small>
                    <small class="text-muted">{{ r.userId }}</small>
                  </div>
                </td> -->

                <!-- UPDATED: use number directly with currency pipe -->
                <td class="fw-bold">{{ r.amount | currency:'EGP':'symbol' }}</td>

                <!-- UPDATED: no .toString() needed -->
                <td>
                  <div class="small text-muted">
                    <i class="bi bi-calendar3 me-1"></i>
                    {{ r.requestDate | date:'medium' }}
                  </div>
                </td>

                <td>
                  <span class="{{ getStatusBadgeClass(r.status) }}">
                    <i class="bi me-1" [ngClass]="getStatusIcon(r.status)"></i>
                    {{ getStatusText(r.status) }}
                  </span>
                </td>

                <td>
                  @if (r.processedDate) {
                    <div class="small text-muted">
                      <i class="bi bi-calendar-check me-1"></i>
                      {{ r.processedDate | date:'medium' }}
                    </div>
                  } @else {
                    <span class="badge bg-light text-dark">—</span>
                  }
                </td>

                <!-- <td>
                  @if (r.processedByAdminName) {
                    <div class="small">
                      <i class="bi bi-person-check me-1"></i>{{ r.processedByAdminName }}
                    </div>
                  } @else {
                    <span class="badge bg-light text-dark">—</span>
                  }
                </td> -->

                <td>
                  @if (r.adminNotes) {
                    <span class="text-truncate d-inline-block" style="max-width: 220px;" [title]="r.adminNotes">
                      {{ r.adminNotes }}
                    </span>
                  } @else {
                    <span class="text-muted">—</span>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</div>
