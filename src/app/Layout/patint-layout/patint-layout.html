<app-nav></app-nav>
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4 text-center">Patient Dashboard</h2>
      
      <!-- Navigation Tabs -->
      <div class="nav-tabs-container mb-4">
        <ul class="nav nav-tabs" id="patientTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link" 
                    [ngClass]="{'active': activeTab === 'requests'}"
                    (click)="setActiveTab('requests')"
                    type="button" 
                    role="tab">
              <i class="fas fa-ambulance me-2"></i>
              Emergency Requests
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" 
                    [ngClass]="{'active': activeTab === 'trips'}"
                    (click)="setActiveTab('trips')"
                    type="button" 
                    role="tab">
              <i class="fas fa-route me-2"></i>
              My Trips
            </button>
          </li>
        </ul>
      </div>

      <!-- Tab Content -->
      <div class="tab-content" id="patientTabContent">
        <!-- Requests Tab -->
        <div class="tab-pane" 
             [ngClass]="{'active show': activeTab === 'requests'}"
             role="tabpanel">
          
          <h3 class="mb-4 text-center">Emergency Requests</h3>
          
          @for (request of requests; track $index) {
          <div class="row mb-3">
            <div class="col-12">
              <div class="simple-request-card">
                <div class="request-main">
                  <div class="request-left">
                    <div class="request-icon">
                      <i class="fas fa-ambulance"></i>
                    </div>
                    <div class="request-details">
                      <h5 class="request-title">{{request.emergencyType}} Emergency</h5>
                      <div class="request-meta">
                        <span class="meta-item">
                          <i class="fas fa-calendar text-muted"></i>
                          {{formatDate(request.requestDate)}}
                        </span>
                        <span class="meta-item">
                          <i class="fas fa-map-marker-alt text-muted"></i>
                          {{request.pickupAddress}}
                        </span>
                        <span class="meta-item">
                          <i class="fas fa-flag-checkered text-muted"></i>
                          {{request.dropOffAddress}}
                        </span>
                      </div>
                      @if (request.notes) {
                      <div class="request-notes">
                        <i class="fas fa-sticky-note text-muted"></i>
                        {{request.notes}}
                      </div>
                      }
                    </div>
                  </div>
                  
                  <div class="request-right">
                    <div class="price-section">
                      <div class="price-label">Total Price</div>
                      <div class="price-amount">{{request.price.toString() | currency:'EGP'}}</div>
                    </div>  
                    
                    <div class="status-section">
                      <span class="status-badge" [ngClass]="getStatusClass(request.status)">
                        {{getStatusText(request.status)}}
                      </span>
                    </div>
                    
                    @if (request.status === 3) {
                    <div class="action-section">
                      <button type="button" class="btn btn-sm btn-outline-danger me-2" 
                              (click)="cancelRequest(request.requestId)"
                              [disabled]="isProcessing">
                        <i class="fas fa-times"></i> Cancel
                      </button>
                      <button type="button" class="btn btn-sm btn-success" 
                              (click)="confirmRequest(request.requestId)"
                              [disabled]="isProcessing">
                        <i class="fas fa-check"></i> Confirm
                      </button>
                    </div>
                    }
                  </div>
                </div>
                
                <!-- Team Information -->
                @if (request.driverId || request.nurseId) {
                <div class="team-info">
                  <div class="team-title">Assigned Team</div>
                  <div class="team-members">
                    @if (request.driverId) {
                    <div class="team-member">
                      <img [src]="getImageUrl(request.driverImg)" alt="Driver" class="member-avatar">
                      <div class="member-details">
                        <div class="member-name">{{request.driverName}}</div>
                        <div class="member-role">Driver</div>
                      </div>
                    </div>
                    }
                    
                    @if (request.nurseId) {
                    <div class="team-member">
                      <img [src]="getImageUrl(request.nurseImg)" alt="Nurse" class="member-avatar">
                      <div class="member-details">
                        <div class="member-name">{{request.nurseName}}</div>
                        <div class="member-role">Nurse</div>
                      </div>
                    </div>
                    }
                  </div>
                </div>
                }
              </div>
            </div>
          </div>
          }

          <!-- No Requests Message -->
          @if (requests.length === 0) {
          <div class="row">
            <div class="col-12">
              <div class="text-center py-5">
                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">No requests available</h4>
                <p class="text-muted">There are currently no patient requests to display.</p>
              </div>
            </div>
          </div>
          }
        </div>

        <!-- Trips Tab -->
        <div class="tab-pane" 
             [ngClass]="{'active show': activeTab === 'trips'}"
             role="tabpanel">
          <app-trip-page></app-trip-page>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>